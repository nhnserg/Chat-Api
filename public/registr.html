<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Chat</title>
  </head>
  <body>
    <div id="auth">
      <h2>Register or Login</h2>
      <div class="controls">
        <h3>Register</h3>
        <input type="text" id="name" placeholder="Enter your name" />
        <input type="text" id="username" placeholder="Enter your username" />
        <input
          type="password"
          id="password"
          placeholder="Enter your password"
        />
        <button onclick="register()">Register</button>

        <h3>Login</h3>
        <input
          type="text"
          id="loginUsername"
          placeholder="Enter your username"
        />
        <input
          type="password"
          id="loginPassword"
          placeholder="Enter your password"
        />
        <button onclick="login()">Login</button>

        <button onclick="logout()">Logout</button>
      </div>
    </div>

    <script>
      // Регистрация
      async function register() {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!name || !email || !password)
          return alert('Name, username, and password are required');

        try {
          const response = await fetch('/auth/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name, email, password }),
          });

          const data = await response.json();
          if (data.message === 'User created successfully') {
            alert('Registration successful! Please log in.');
          } else {
            alert(data.message);
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
      }

      // Логин
      async function login() {
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        if (!email || !password)
          return alert('Username and password are required');

        try {
          const response = await fetch('/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();
          if (data.token) {
            localStorage.setItem('accessToken', data.token);
            alert('Login successful!');
            window.location.reload(); // Перезагружаем страницу или перенаправляем в чат
          } else {
            alert(data.message);
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
      }

      // Логаут
      async function logout() {
        const token = localStorage.getItem('accessToken');

        if (!token) {
          return alert('You are not logged in');
        }

        try {
          const response = await fetch('/auth/logout', {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
          });

          const data = await response.json();
          if (data.message === 'Logged out successfully') {
            localStorage.removeItem('accessToken');
            alert('Logged out successfully');
          } else {
            alert(data.message);
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
      }
    </script>
  </body>
</html>
